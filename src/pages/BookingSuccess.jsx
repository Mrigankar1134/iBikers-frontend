import { useEffect, useRef } from 'react';
import { Link, useNavigate, useLocation } from 'react-router-dom';
import gsap from 'gsap';
import '../styles/BookingSuccess.scss';

const BookingSuccess = () => {
  const navigate = useNavigate();
  const location = useLocation();
  const contentRef = useRef(null);
  const buttonsRef = useRef([]);
  
  // Clear and set refs array
  buttonsRef.current = [];
  const addToRefs = (el) => {
    if (el && !buttonsRef.current.includes(el)) {
      buttonsRef.current.push(el);
    }
  };

  useEffect(() => {
    // Check if user came from a booking
    // If not, redirect to home page
    if (!location.state || !location.state.fromBooking) {
      navigate('/');
      return;
    }

    // Animate content
    gsap.fromTo(contentRef.current,
      { y: 30, opacity: 0 },
      { y: 0, opacity: 1, duration: 0.6 }
    );
    
    // Animate buttons one by one
    const buttons = buttonsRef.current;
    buttons.forEach((button, index) => {
      gsap.fromTo(button,
        { y: 20, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.4, delay: 0.3 + (index * 0.15) }
      );
    });
  }, [navigate, location]);

  return (
    <div className="booking-success-page">
      <div className="success-content" ref={contentRef}>
        <div className="success-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.7649 14.1003 1.98232 16.07 2.85999" stroke="#22C55E" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
            <path d="M22 4L12 14.01L9 11.01" stroke="#22C55E" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
          </svg>
        </div>
        <h1>Booking Successful!</h1>
        <p>Your bike has been booked successfully.</p>
        
        <div className="action-buttons">
          <a 
            href="https://chat.whatsapp.com/HlHy88SGGW9LTnhUxoVHp3" 
            target="_blank" 
            rel="noopener noreferrer"
            className="whatsapp-button"
            ref={addToRefs}
          >
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fillRule="evenodd" clipRule="evenodd" d="M19.3764 4.62392C17.2619 2.50291 14.4454 1.32007 11.4649 1.31445C5.34857 1.31445 0.364803 6.29461 0.359179 12.4137C0.356867 14.3145 0.837803 16.1709 1.75351 17.8145L0.272949 23.6875L6.29101 22.2375C7.87476 23.0702 9.65351 23.5114 11.4649 23.5125H11.4705C17.5857 23.5125 22.5695 18.5312 22.5751 12.4121C22.5807 9.43945 21.4909 6.74492 19.3764 4.62392ZM11.4649 21.6562H11.4604C9.85351 21.6551 8.27726 21.2319 6.89726 20.4319L6.55976 20.2312L3.16351 21.0937L4.04226 17.7862L3.82101 17.4375C2.93976 15.9994 2.47101 14.3302 2.47351 12.6137C2.47913 7.32007 6.47351 3.17007 11.4695 3.17007C13.9604 3.17429 16.3125 4.16367 18.0364 5.89492C19.7602 7.62617 20.7414 9.98242 20.7382 12.4121C20.7325 17.7057 16.7382 21.6562 11.4649 21.6562ZM16.6857 15.0244C16.4114 14.8869 15.0364 14.2119 14.7845 14.1182C14.5325 14.0244 14.3489 13.9775 14.1652 14.2525C13.9814 14.5275 13.4464 15.1557 13.2845 15.3394C13.1227 15.5232 12.9607 15.5469 12.6864 15.4094C12.412 15.2719 11.5214 14.9869 10.4695 14.0494C9.64226 13.3162 9.08351 12.4137 8.92163 12.1387C8.75976 11.8637 8.90351 11.7137 9.04101 11.5762C9.16351 11.4525 9.31351 11.2537 9.45101 11.0919C9.58851 10.93 9.63538 10.8125 9.72913 10.6287C9.82288 10.445 9.77601 10.2832 9.70663 10.1457C9.63726 10.0082 9.08101 8.63242 8.85101 8.08242C8.62726 7.54805 8.39976 7.61742 8.22913 7.60867C8.06726 7.60055 7.88351 7.59867 7.69976 7.59867C7.51601 7.59867 7.21726 7.66805 6.96538 7.94305C6.71351 8.21805 5.99101 8.89305 5.99101 10.2687C5.99101 11.6444 6.99976 12.9732 7.13726 13.157C7.27476 13.3407 9.07913 16.1307 11.8414 17.3369C12.5414 17.6369 13.0882 17.8182 13.5139 17.9557C14.2139 18.1869 14.8482 18.1557 15.3482 18.0844C15.9057 18.0057 17.0232 17.4119 17.2532 16.7682C17.4832 16.1244 17.4832 15.5744 17.4139 15.4594C17.3445 15.3444 17.1607 15.2762 16.8857 15.1387L16.6857 15.0244Z" fill="white"/>
            </svg>
            Join WhatsApp Community
          </a>
          
          <a 
            href="https://wa.me/+919504085344" 
            target="_blank" 
            rel="noopener noreferrer"
            className="whatsapp-button"
            ref={addToRefs}
          >
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fillRule="evenodd" clipRule="evenodd" d="M19.3764 4.62392C17.2619 2.50291 14.4454 1.32007 11.4649 1.31445C5.34857 1.31445 0.364803 6.29461 0.359179 12.4137C0.356867 14.3145 0.837803 16.1709 1.75351 17.8145L0.272949 23.6875L6.29101 22.2375C7.87476 23.0702 9.65351 23.5114 11.4649 23.5125H11.4705C17.5857 23.5125 22.5695 18.5312 22.5751 12.4121C22.5807 9.43945 21.4909 6.74492 19.3764 4.62392ZM11.4649 21.6562H11.4604C9.85351 21.6551 8.27726 21.2319 6.89726 20.4319L6.55976 20.2312L3.16351 21.0937L4.04226 17.7862L3.82101 17.4375C2.93976 15.9994 2.47101 14.3302 2.47351 12.6137C2.47913 7.32007 6.47351 3.17007 11.4695 3.17007C13.9604 3.17429 16.3125 4.16367 18.0364 5.89492C19.7602 7.62617 20.7414 9.98242 20.7382 12.4121C20.7325 17.7057 16.7382 21.6562 11.4649 21.6562ZM16.6857 15.0244C16.4114 14.8869 15.0364 14.2119 14.7845 14.1182C14.5325 14.0244 14.3489 13.9775 14.1652 14.2525C13.9814 14.5275 13.4464 15.1557 13.2845 15.3394C13.1227 15.5232 12.9607 15.5469 12.6864 15.4094C12.412 15.2719 11.5214 14.9869 10.4695 14.0494C9.64226 13.3162 9.08351 12.4137 8.92163 12.1387C8.75976 11.8637 8.90351 11.7137 9.04101 11.5762C9.16351 11.4525 9.31351 11.2537 9.45101 11.0919C9.58851 10.93 9.63538 10.8125 9.72913 10.6287C9.82288 10.445 9.77601 10.2832 9.70663 10.1457C9.63726 10.0082 9.08101 8.63242 8.85101 8.08242C8.62726 7.54805 8.39976 7.61742 8.22913 7.60867C8.06726 7.60055 7.88351 7.59867 7.69976 7.59867C7.51601 7.59867 7.21726 7.66805 6.96538 7.94305C6.71351 8.21805 5.99101 8.89305 5.99101 10.2687C5.99101 11.6444 6.99976 12.9732 7.13726 13.157C7.27476 13.3407 9.07913 16.1307 11.8414 17.3369C12.5414 17.6369 13.0882 17.8182 13.5139 17.9557C14.2139 18.1869 14.8482 18.1557 15.3482 18.0844C15.9057 18.0057 17.0232 17.4119 17.2532 16.7682C17.4832 16.1244 17.4832 15.5744 17.4139 15.4594C17.3445 15.3444 17.1607 15.2762 16.8857 15.1387L16.6857 15.0244Z" fill="white"/>
            </svg>
            WhatsApp Suraj
          </a>
          
          <Link 
            to="/" 
            className="home-button"
            ref={addToRefs}
          >
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
              <path d="M9 22V12H15V22" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
            Back to Home
          </Link>
        </div>
      </div>
    </div>
  );
};

export default BookingSuccess;